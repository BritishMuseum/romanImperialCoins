<!-- Start of messages -->
<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Well done!</strong> You have successfully submitted your transcription. Here is another to try if you
        wish!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Loading next task...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>The task has been completed!</strong> Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>Congratulations!</h2>
        <p>
            You have participated in all available tasks!
        </p>
        <img src="/static/img/MP_SQUARE_notype.png"
             height="200" width="200" alt="The MicroPasts Square Logo"/>
        <div class="alert-actions">
            <a class="btn-default btn" href="/">Go back to the home page</a>
            <a class="btn-default btn" href="/app">or, have a look at our
                other applications</a>
        </div>
    </div>
    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">Ã—</a>
        <strong>Error!</strong> Something went wrong, please contact the site administrators
    </div>
</div>
<!-- End Success and Error Messages for the user -->


<!--
    Task DOM for loading the S3 Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<div class="row skeleton">
    <!-- Button row -->
    <div class="row">
        <div class="btn-group">
            <button class="btn btn-info btn-xs" data-toggle="modal" data-target="#myModal"><i
                    class="glyphicon glyphicon-eye-open"></i> Tutorial
            </button>
            <a class="btn btn-info btn-xs" id="support" target="_blank" data-toggle="tooltip" data-placement="top"
               title="Opens in a new window" href="http://community.micropasts.org/category/crowd-sourcing-support"><i
                    class="glyphicon glyphicon-book"></i> Community Help</a>
        </div>
    </div>
    <!-- End of button row -->

    <!-- The transcribe section using html table -->
    <div class="row" id="crowdmatchCoin">

        <h4>Can you assign this coin to an RIC number?</h4>

        <div class="row">
            <div class="pasCoin">
                <img id="pasImage" class="pull-right" width="500" src=""/>
                <ul id="details">
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="ocreMatches">
                <h2>Possible matches</h2>
                <div id="matches">

                </div>
            </div>
        </div>
        <div class="row">
            <div class="comments"></div>
        </div>

        <button class="btn btn-success btn-answer" value='Yes'>Submit your answer</button>

        <!-- Feedback items for the user -->
        <p>You are working now on task: <span id="task-id" class="label label-warning">#</span></p>
        <p>You have completed: <span id="done" class="label label-info"></span> tasks from
            <!-- Progress bar for the user -->
            <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
        </div>
        <!-- End of feedback row -->

    </div>
    <!-- End of the transcribe section -->
</div>
<!-- End of DOM Skeleton row -->

<!-- Client side scripts -->
<script>
// Quick fix for IE8
Modernizr.load({
  test: window.JSON,
  nope: '/static/js/vendor/json2.min.js'
});


</script>

<script>
$(document).ready(function() {
    <!--$.ajax({-->
        <!--url: 'https://finds.org.uk/database/artefacts/record/id/1/format/json',-->
        <!--dataType: 'json',-->
        <!--success: function(data){-->
            <!--console.log(data);-->
        <!--},-->
        <!--error: function() {-->
            <!--alert("error with call");-->
        <!--}-->
    <!--});-->



});


</script>

<!-- Step through modals -->
<script type="text/javascript">
    var step = -1;
    function showStep(action) {
        $("#" + step).hide();
        if (action == 'next') {
            step = step + 1;
        }
        if (action == 'prev') {
            step = step - 1;
        }
        if (step == 0) {
            $("#prevBtn").hide();
        }
        else {
            $("#prevBtn").show();
        }
        if (step == 2) {
            $("#nextBtn").hide();
            $("#startContrib").show();
        }
        $("#" + step).show();
    }
    showStep('next');
    $("#modal").modal('show');




</script>

<!-- Pyboss scripts -->
<script>
    function loadUserProgress() {
        pybossa.userProgress('ricConcordance').done(function(data){
            console.log("Total answers done for user: " + data.done);
            var pct = Math.round((data.done*100)/data.total);
            $("#progress").css("width", pct.toString() +"%");
            $("#progress").attr("title", pct.toString() + "% completed!");
            $("#progress").tooltip({'placement': 'left'});
            $("#total").text(data.total);
            $("#done").text(data.done);
            $('a[rel]').tooltip({'placement': 'left'});
        });
    }
    pybossa.taskLoaded(function(task, deferred) {
        if ( ! $.isEmptyObject(task) ) {
            loadUserProgress();
            console.log("User progress");
            deferred.resolve(task);
        } else {
            deferred.resolve(task);
        }
    });
      $(window).resize(function(){
        console.log('Window resized');
      });
    pybossa.presentTask(function(task, deferred) {
        if ( !$.isEmptyObject(task) ) {
        console.log(task);
        $.ajax({
        url: task.info.object + '/format/json',
        dataType: 'json',
        success: function(data){
            console.log(data[1][0]);

            var numismatic = {};

            numismatic['Record ID'] = data[1][0].old_findID;

            if(data[1][0].obverseInscription != null) {
                numismatic['Obverse inscription'] = data[1][0].obverseInscription;
            }

            if(data[1][0].obverseDescription != null) {
                numismatic['Obverse description'] = data[1][0].obverseDescription;
            }

            if(data[1][0].reverseInscription != null) {
                numismatic['Reverse inscription'] = data[1][0].reverseInscription;
            }

            if(data[1][0].reverseDescription != null) {
                numismatic['Reverse description'] = data[1][0].reverseDescription;
            }

            if(data[1][0].mintName != null) {
                numismatic['Mint'] = data[1][0].mintName;
            }

            if(data[1][0].primaryRuler != null) {
                numismatic['Issuer'] = data[1][0].primaryRuler;
            }
            if(data[1][0].denomination != null) {
                numismatic['Denomination'] = data[1][0].denomination;
            }
            if(data[1][0].description != null) {
                numismatic['Description'] = data[1][0].description;
            }

            if(data[1][0].ricID != null) {
                numismatic['Current RIC ID'] = data[1][0].ricID;
            }

            console.log(numismatic);

            if(data[1][0].filename != null) {
                var filename = data[1][0].filename;
                var imageDir = data[1][0].imagedir;
                var root = 'https://finds.org.uk/';
                $("#pasImage").attr("src", root + imageDir + filename);
            }

            $.each(numismatic, function(key, value) {
                var html = "<li>" + key + " : " + value + "</li>";
                console.log(html);
                $('#details').append(html);
            });

        },
        error: function() {
            alert("error with call");
        }
    });
      var ids = [];

      ids.push(task.info.match1);
      if(task.info.match2 != null) {
        ids.push(task.info.match2);
      }
      if(task.info.match3 != null) {
        ids.push(task.info.match3);
      }
      if(task.info.match4 != null) {
        ids.push(task.info.match4);
      }
      console.log(ids);
        var nomismaUrl = "http://nomisma.org/apis/numishareResults?identifiers=";
        var baseUri = "&baseUri=http://numismatics.org/ocre/id/";
        var identifiers = ids.join("|");
        var apiCall = nomismaUrl + identifiers + baseUri + "&format=json";
        console.log(apiCall);
        $.ajax({
                type: "get",
                url: apiCall,
                dataType: "json",
                success: function(data) {
                    console.log(data);
                    var matches = [];
                    matches.push(data.types[0]);
                    matches.push(data.types[1]);
                    matches.push(data.types[2]);
                    console.log(matches);
                    $.each(matches, function(index, item){
                        var html;
                        html = '<h3>' + item.id + '</h3><p>Specimen count on Ocre:</p>';
                        var objects = item.objects;
                        $.each(objects, function(index, object){
                         if(object.obvRef != null) {
                            html += '<img src="' + object.obvRef + '" width="200"/>';
                            }
                        });
                        $('#matches').append(html);
                    });
                },
                error: function(xhr, status) {
                    //alert("error with call");
                }
            });

        $("#question").html(task.info.question);
        $('#task-id').html(task.id);
        $('#support').tooltip({'placement': 'top'});

        $('.btn-answer').off('click').on('click', function(evt) {
            evt.preventDefault();
            var answer = $(evt.target).attr("value");
            if (typeof answer != 'undefined') {
                task.answer = $("#transcription").serializeJSON();
                console.log(task.answer);
                console.log(data);
                task.answer.transcription = data;
                task.answer.comments = $("#comments").val();
                console.log(task.answer);
                pybossa.saveTask(task.id, task.answer).done(function() {
                    $("html, body").animate({ scrollTop: 0 }, "slow");
                    $("#success").fadeIn(500).fadeOut(500);
                    $("#loading").fadeIn(500).fadeOut(500);
                    map.setTarget(null);
                    $('#comments').val('');
                    deferred.resolve();
                });
            } else {
                $("#error").show();
            }
        });
            $("#loading").hide();
        } else {
            $(".skeleton").hide();
            $("#loading").hide();
            $("#finish").fadeIn(500);
        }
    });
    pybossa.run('ricConcordance');








</script>